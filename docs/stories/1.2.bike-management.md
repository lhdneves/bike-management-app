# Story 1.2: Bike & Component Management

## Status
Done

## Story
**As a** bicycle owner,
**I want** to register my bicycles and their components in the system,
**so that** I can track their maintenance, manage expenses, and schedule future services.

## Acceptance Criteria
1. User can access a main dashboard after login
2. Dashboard displays cards for registered bikes
3. Empty state message when no bikes are registered
4. User can register a new bike with required and optional fields
5. User can add components to registered bikes
6. User can view and edit bike details
7. User can view and edit component details

## Tasks / Subtasks
- [ ] Task 1: Update database schema for bikes and components (AC: 4, 5)
  - [ ] Create bikes table migration
  - [ ] Create components table migration
  - [ ] Update Prisma schema
  - [ ] Run database migrations
- [ ] Task 2: Create bike management backend API (AC: 4, 6)
  - [ ] Set up Express.js routes for bikes CRUD
  - [ ] Implement bike validation schemas
  - [ ] Create bike controller methods
  - [ ] Add authorization middleware for user bikes
  - [ ] Return appropriate success/error responses
- [ ] Task 3: Create component management backend API (AC: 5, 7)
  - [ ] Set up Express.js routes for components CRUD
  - [ ] Implement component validation schemas
  - [ ] Create component controller methods
  - [ ] Link components to specific bikes
  - [ ] Return appropriate success/error responses
- [ ] Task 4: Create main dashboard frontend (AC: 1, 2, 3)
  - [ ] Design dashboard layout with bike cards
  - [ ] Implement empty state for no bikes
  - [ ] Add "Add Bike" call-to-action
  - [ ] Connect to bikes API endpoint
  - [ ] Handle loading and error states
- [ ] Task 5: Create bike registration form (AC: 4)
  - [ ] Design bike registration form with Next.js and Tailwind CSS
  - [ ] Add form fields: name (required), description, manufacturer, type, traction
  - [ ] Implement client-side validation
  - [ ] Connect form to bike creation API endpoint
  - [ ] Handle success/error states with clear messaging
- [ ] Task 6: Create bike details and edit functionality (AC: 6)
  - [ ] Design bike detail view page
  - [ ] Add edit bike form
  - [ ] Implement bike update functionality
  - [ ] Add bike deletion with confirmation
  - [ ] Handle navigation between views
- [ ] Task 7: Create component management functionality (AC: 5, 7)
  - [ ] Design component list view for each bike
  - [ ] Create add component form
  - [ ] Implement component edit functionality
  - [ ] Add component deletion with confirmation
  - [ ] Link component management to bike details
- [ ] Task 8: Write comprehensive tests (AC: All)
  - [ ] Unit tests for bike and component API endpoints
  - [ ] Integration tests for CRUD operations
  - [ ] Frontend component tests for forms and dashboard
  - [ ] End-to-end tests for complete bike management flow

## Dev Notes

### Previous Story Dependencies
This story builds upon Story 1.1 (User Authentication & Registration):
- User authentication system must be functional
- JWT tokens used for API authorization
- Dashboard is a protected route requiring authentication

### Data Models
Based on the database schema, this story will interact with:

**Bikes Table Structure** [Source: docs/database-schema.md#bikes-table]:
- `id` (UUID, Primary Key) - Unique identifier for the bike
- `owner_id` (UUID, Foreign Key to users.id, Not Null) - Links the bike to its owner
- `name` (TEXT, Not Null) - Name given to the bike (e.g., "Minha Mountain Bike")
- `description` (TEXT, Optional) - Short description of the bike
- `manufacturer` (TEXT, Optional) - Bike manufacturer
- `type` (ENUM: 'SPEED', 'MOUNTAIN_BIKE', 'ELECTRIC', 'URBAN', etc., Not Null) - Type of bicycle
- `traction_type` (ENUM: 'MANUAL', 'ASSISTED', Not Null) - Specifies if it's manual or assisted/electric
- `created_at` (TIMESTAMP, Not Null, Default: CURRENT_TIMESTAMP)
- `updated_at` (TIMESTAMP, Not Null, Default: CURRENT_TIMESTAMP, On Update: CURRENT_TIMESTAMP)

**Components Table Structure** [Source: docs/database-schema.md#components-table]:
- `id` (UUID, Primary Key) - Unique identifier for the component
- `bike_id` (UUID, Foreign Key to bikes.id, Not Null) - Links the component to a specific bike
- `name` (TEXT, Not Null) - Name of the component (e.g., "Pneu Dianteiro", "Corrente")
- `description` (TEXT, Optional) - Detailed description of the component
- `installation_date` (DATE, Optional) - Date when the component was installed or last replaced
- `observation` (TEXT, Optional) - Any relevant observations about the component
- `created_at` (TIMESTAMP, Not Null, Default: CURRENT_TIMESTAMP)
- `updated_at` (TIMESTAMP, Not Null, Default: CURRENT_TIMESTAMP, On Update: CURRENT_TIMESTAMP)

### API Specifications
**Required API Endpoints**:
- GET /api/bikes - List user's bikes
- POST /api/bikes - Create new bike
- GET /api/bikes/:id - Get specific bike details
- PUT /api/bikes/:id - Update bike information
- DELETE /api/bikes/:id - Delete bike
- GET /api/bikes/:id/components - List bike components
- POST /api/bikes/:id/components - Add component to bike
- GET /api/components/:id - Get specific component details
- PUT /api/components/:id - Update component information
- DELETE /api/components/:id - Delete component

### Component Specifications
**Frontend Pages/Components**:
- **Dashboard**: Main landing page showing bike cards and empty state
- **BikeCard Component**: Reusable card showing bike summary
- **AddBikeForm**: Form for registering new bikes
- **BikeDetails**: Detailed view with components list
- **EditBikeForm**: Form for updating bike information
- **ComponentForm**: Form for adding/editing components
- **ComponentList**: List of components for a bike

### UI/UX Considerations
**Based on UI/UX Specifications** [Source: docs/ui-ux-spec.md]:
- **Dashboard Layout**: Card-based grid layout for bikes
- **Empty State**: Friendly message with prominent "Add Your First Bike" button
- **Forms**: Consistent styling with Story 1.1 authentication forms
- **Navigation**: Clear navigation between dashboard, bike details, and forms
- **Responsive Design**: Mobile-friendly layouts for all views

### Technical Constraints
**Security Requirements**:
- All bike and component operations must verify user ownership
- JWT authentication required for all protected routes
- Input validation on both client and server side
- Proper error handling for unauthorized access

**Performance Considerations**:
- Efficient database queries with proper indexing
- Optimistic UI updates for better user experience
- Image upload capability for bike photos (future enhancement)
- Pagination for users with many bikes (future enhancement)

### Testing Requirements
**Comprehensive Testing Strategy**:
- Unit tests for all CRUD operations
- Integration tests for API endpoints
- Component tests for React forms and views
- End-to-end tests for complete user workflows
- Security tests for authorization and data access

## Story Dependencies
- **Requires**: Story 1.1 (User Authentication) - COMPLETED
- **Blocks**: Story 1.3 (Maintenance Tracking) - depends on bike registration

## Estimated Effort
**Complexity**: Medium
**Estimated Duration**: 3-4 days
**Story Points**: 8

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-26 | 1.0 | Initial story creation | Development Team |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review of the completed story implementation*