# Story 1.1: User Authentication & Registration

## Status
Draft

## Story
**As a** bicycle owner,
**I want** to register in the application and log in with my credentials,
**so that** I can access the system to manage my bicycles and their maintenance.

## Acceptance Criteria
1. User can log in with email/password
2. New users can register with name, email, phone, password
3. Email verification (repeat entry)
4. Password verification (repeat entry)
5. Optional Google OAuth integration
6. Secure password storage and validation

## Tasks / Subtasks
- [ ] Task 1: Create user registration API endpoint (AC: 2, 3, 4, 6)
  - [ ] Set up Express.js route for POST /api/auth/register
  - [ ] Implement input validation for name, email, phone, password
  - [ ] Add email repeat validation
  - [ ] Add password repeat validation and complexity requirements
  - [ ] Hash password using bcrypt before storing
  - [ ] Create user record in Supabase database
  - [ ] Return appropriate success/error responses
- [ ] Task 2: Create user login API endpoint (AC: 1, 6)
  - [ ] Set up Express.js route for POST /api/auth/login
  - [ ] Implement email/password validation
  - [ ] Verify password against stored hash
  - [ ] Generate JWT token for authenticated sessions
  - [ ] Return user data and token on success
- [ ] Task 3: Create registration frontend form (AC: 2, 3, 4)
  - [ ] Design registration form with Next.js and Tailwind CSS
  - [ ] Add form fields: name, email, confirm email, phone, password, confirm password
  - [ ] Implement client-side validation
  - [ ] Add Terms & Conditions acceptance checkbox
  - [ ] Connect form to registration API endpoint
  - [ ] Handle success/error states with clear messaging
- [ ] Task 4: Create login frontend form (AC: 1)
  - [ ] Design login form with Next.js and Tailwind CSS
  - [ ] Add email and password input fields
  - [ ] Implement "Forgot Password" link
  - [ ] Connect form to login API endpoint
  - [ ] Handle authentication success (redirect to dashboard)
  - [ ] Display clear error messages for failed login attempts
- [ ] Task 5: Implement Google OAuth integration (AC: 5)
  - [ ] Set up Google OAuth configuration
  - [ ] Add Google login button to login/registration forms
  - [ ] Implement OAuth callback handling
  - [ ] Create or link Google accounts to existing user records
- [ ] Task 6: Create password recovery functionality
  - [ ] Implement "Forgot Password" API endpoint
  - [ ] Set up email service integration for password reset
  - [ ] Create password reset form and API endpoint
  - [ ] Add password reset token validation
- [ ] Task 7: Write comprehensive tests (AC: All)
  - [ ] Unit tests for authentication API endpoints
  - [ ] Integration tests for registration/login flow
  - [ ] Frontend component tests for forms
  - [ ] End-to-end tests for complete authentication flow

## Dev Notes

### Previous Story Insights
No previous stories exist - this is the first story in the project.

### Data Models
Based on the database schema, the user authentication will interact with:

**Users Table Structure** [Source: docs/database-schema.md#users-table]:
- `id` (UUID, Primary Key) - Unique identifier for the user
- `name` (TEXT, Not Null) - Full name of the user
- `email` (TEXT, Unique, Not Null) - User's email, used for login and unique identification
- `password_hash` (TEXT, Not Null) - Hashed password for security
- `phone_number` (TEXT, Optional) - User's phone number
- `role` (ENUM: 'BIKE_OWNER', 'MECHANIC', 'ADMIN', Not Null) - Defines the user's role in the system
- `created_at` (TIMESTAMP, Not Null, Default: CURRENT_TIMESTAMP)
- `updated_at` (TIMESTAMP, Not Null, Default: CURRENT_TIMESTAMP, On Update: CURRENT_TIMESTAMP)

### API Specifications
**Authentication Endpoints** [Source: docs/architecture.md#backend-server-side-api]:
- Backend built with Node.js and Express.js framework
- Exposes RESTful APIs for authentication
- Manages user authentication using JSON Web Tokens (JWT)
- Handles authorization, data validation, and core application logic

**Required API Endpoints**:
- POST /api/auth/register - User registration
- POST /api/auth/login - User login
- POST /api/auth/forgot-password - Password recovery initiation
- POST /api/auth/reset-password - Password reset completion

### Component Specifications
**Frontend Architecture** [Source: docs/architecture.md#frontend-client-application]:
- Developed using Next.js, TypeScript, and Tailwind CSS
- Responsible for entire User Interface (UI) and User Experience (UX)
- Handles user interactions, renders dynamic content, and communicates with Backend API
- Accessible via web browsers (potentially as Progressive Web App)

**UI Components Based on Wireframes** [Source: docs/ui-ux-spec.md#wireframes-mockups]:
- **Login/Registration Screen**: Large central card with input fields and buttons
- **Registration Form Elements**: Name, email (with confirmation), phone, password (with confirmation), Terms & Conditions checkbox
- **Login Form Elements**: Email input, password input, "Entrar" button, "Novo Cadastro" link, "Esqueci minha senha" link

### File Locations
No specific guidance found in architecture docs for exact file structure. Based on Next.js conventions:
- API routes: `/pages/api/auth/` or `/app/api/auth/` (depending on Next.js version)
- Frontend pages: `/pages/auth/` or `/app/auth/`
- Components: `/components/auth/`

### Technical Constraints
**Security Requirements** [Source: docs/architecture.md#database-data-storage-realtime]:
- User profiles with hashed passwords for security
- Utilizes Supabase providing robust PostgreSQL database
- Leverages Supabase's features for authentication

**Database Integration** [Source: docs/architecture.md#backend-server-side-api]:
- Interacts with database using Prisma ORM for efficient and type-safe data access

**Email Service Integration** [Source: docs/architecture.md#email-service-integration]:
- External service integrated with Backend for automated maintenance reminders and password recovery emails

### Testing
**Testing Requirements**:
Based on the project structure, comprehensive testing should include:
- Unit tests for API endpoints
- Integration tests for authentication flow
- Frontend component tests
- End-to-end user journey tests

No specific testing standards found in architecture docs.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-25 | 1.0 | Initial story creation | BMad System |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review of the completed story implementation*